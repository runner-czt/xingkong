<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
	<title>快乐班级投票页</title>

	<link rel="stylesheet" href="css/global.css">
	<link rel="stylesheet" href="src/zepto.fullpage.css">
	<link rel="stylesheet" href="css/animate.css">
	<link rel="stylesheet" href="css/animations.css">
	<link rel="stylesheet" href="css/index.css">
	<link rel="stylesheet" href="css/style.css" media="screen" type="text/css" />
<!-- 
	<link rel="stylesheet" href="__PUBLIC__/css/global.css">
	<link rel="stylesheet" href="__PUBLIC__/css/zepto.fullpage.css">
	<link rel="stylesheet" href="__PUBLIC__/css/animate.css">
	<link rel="stylesheet" href="__PUBLIC__/css/animations.css">
	<link rel="stylesheet" href="__PUBLIC__/css/index_moblie.css">
	<link rel="stylesheet" href="__PUBLIC__/css/style.css" media="screen" type="text/css"/>
-->
</head>
<style>
	.t1{
		animation-delay: 1s;
		-moz-animation-delay: 1s;
		-webkit-animation-delay: 1s;
	}
	.t1-5{
		animation-delay: 1.5s;
		-moz-animation-delay: 1.5s;
		-webkit-animation-delay: 1.5s;
	}
	.t2{
		animation-delay: 2s;
		-moz-animation-delay: 2s;
		-webkit-animation-delay: 2s;
	}
	.t2-5{
		animation-delay: 2.5s;
		-moz-animation-delay: 2.5s;
		-webkit-animation-delay: 2.5s;
	}
	.t2-8{
		animation-delay: 2.8s;
		-moz-animation-delay: 2.8s;
		-webkit-animation-delay: 2.8s;
	}
	.t3{
		animation-delay: 3s;
		-moz-animation-delay: 3s;
		-webkit-animation-delay: 3s;
	}
	.t4{
		animation-delay: 4s;
		-moz-animation-delay: 4s;
		-webkit-animation-delay: 4s;
	}
	@media(max-width: 320px){
		
	}
	.disable{
		background: #dedfe0;
	}
/*	@-webkit-keyframes glow {
		0% {
			-webkit-box-shadow: 0 0 16px rgba(72, 106, 170, 0.7);
			border-color: rgba(160, 179, 214, 0.7);         
		}
		100% {
			-webkit-box-shadow: 0 0 18px rgba(72, 106, 170, 1.0), 0 0 24px rgba(0, 140, 255, 1.0);
			border-color: rgba(160, 179, 214, 1.0); 
		}
	}

	.onthis{
/*		background-color:#f0f3f9;*/
/*		-webkit-animation-name: glow;
		-webkit-animation-duration: 1s;
		-webkit-animation-iteration-count: infinite;
		-webkit-animation-direction: alternate;
		-webkit-animation-timing-function: ease-in-out; 
	}*/
/*	.skillbar-bar span{
		background-color: rgba(0, 0, 0, .1);
	}
*/
	.btn {
		border: 1px solid gray;
		width: 100%;
		height: 30px;
		font-size: 18px;
		cursor: pointer;
	}
	#embed-captcha {
		width: 300px;
		margin: 0 auto;
	}
	.show {
		display: block;
	}
	.hide {
		display: none;
	}
	/* 可自行设计实现captcha的位置大小 */
	.popup-mobile {
		position: relative;
		width: 100%;
	}
	#popup-captcha-mobile {
		position: absolute;
		width: 260px;
		height: 474px;
		display: none;
		left: 50%;
		top: 50%;
		transform: translate(-50%, -50%);
		-webkit-transform: translate(-50%, -50%);
		z-index: 9999;
	}
</style>
<body>
	<div class="wp">
		<div class="wp-inner">

			<div class="page page1">
				<!-- 上部分 -->
				<div class="top">
					<div class="js-animate animated left" data-animate="rotateInUpLeft"></div>
					<div class="js-animate animated right" data-animate="rotateInUpRight"></div>
					<div class="js-animate animated t1 title" data-animate="bounceIn"></div>
				</div>
				<!-- 下部分 -->
				<div class="bottom">
					<!-- logo -->
					<div class="logo">
						<div class="js-animate animated t1-5 xingkong" data-animate="lightSpeedIn"></div>
						<div class="js-animate animated t1 xiaohui" data-animate="slideInLeft"></div>
					</div>
					<!-- 文字 -->
					<div class="fonts">
						<div class="js-animate animated t2 font-1" data-animate="fadeInDown"></div>
						<div class="js-animate animated t2-8 font-2" data-animate="fadeInDown"></div>
						<div class="js-animate animated t3 font-3" data-animate="fadeInDown"></div>
					</div>
				</div>
				
			</div>

			<div class="page page2">
				<div class="js-animate animated title2" data-animate="pulse" id="title2"></div>
				<div class="js-animate animated kuangkuang" data-animate="flash">
					<div class="js-animate animated t1 shipin" data-animate="fadeInDown"></div>
					<div class="js-animate animated t1-5 xianchang" data-animate="fadeInDown"></div>
				</div>
				<!-- 下部分 -->
				<div class="bottom">
					<!-- logo -->
					<div class="logo">
						<div class="js-animate animated t1-5 xingkong" data-animate="lightSpeedIn"></div>
						<div class="js-animate animated t1 xiaohui" data-animate="slideInLeft"></div>
					</div>
				</div>
			</div>
			
			<div class="page page3">
				<div class="Bar" id="Bar">
					<!-- 标题 -->
					<h3 style="text-align:center;" class="js-animate bounce" data-animate="bounce">快乐班级投票页</h3>

					<div class="skillbar clearfix" data-percent="40%">
						<div class="skillbar-bar skillbar-bar1 "><span>15建筑3班</span></div>
						<div class="skill-bar-percent">40票</div>
					</div>

					<div class="skillbar clearfix" data-percent="8%">
						<div class="skillbar-bar skillbar-bar2"><span>14车辆2班</span></div>
						<div class="skill-bar-percent">8票</div>
					</div>

					<div class="skillbar clearfix onthis" data-percent="12%">
						<div class="skillbar-bar skillbar-bar3"><span>16机电2班</span></div>
						<div class="skill-bar-percent">12票</div>
					</div>

					<div class="skillbar clearfix " data-percent="5%">
						<div class="skillbar-bar skillbar-bar4"><span>14金融6班</span></div>
						<div class="skill-bar-percent">5票</div>
					</div>

					<div class="skillbar clearfix " data-percent="8%">
						<div class="skillbar-bar skillbar-bar5"><span>14车辆3班</span></div>
						<div class="skill-bar-percent">8票</div>
					</div>

					<div class="skillbar clearfix " data-percent="2%">
						<div class="skillbar-bar skillbar-bar6"><span>15人力1班</span></div>
						<div class="skill-bar-percent">2票</div>
					</div>

					<div class="skillbar clearfix " data-percent="4%">
						<div class="skillbar-bar skillbar-bar7"><span>15电气3班</span></div>
						<div class="skill-bar-percent">4票</div>
					</div>

					<div class="skillbar clearfix " data-percent="6%">
						<div class="skillbar-bar skillbar-bar8"><span>15会计3班</span></div>
						<div class="skill-bar-percent">6票</div>
					</div>

					<div class="skillbar clearfix " data-percent="7%">
						<div class="skillbar-bar skillbar-bar9"><span>15英语3班</span></div>
						<div class="skill-bar-percent">7票</div>
					</div>

					<div class="skillbar clearfix " data-percent="8%">
						<div class="skillbar-bar skillbar-bar0"><span>15国贸3班</span></div>
						<div class="skill-bar-percent">8票</div>
					</div>

					<!-- 验证码 -->
					<div class="popup-mobile">
						<input class="btn" id="popup-submit-mobile" type="button" value="确定">
						<div id="popup-captcha-mobile"></div>
					</div>
				</div>
				<!-- 投票引导文字层 -->
				<div class="hint" style="background:rgba(0,0,0,0.5);opacity:0;position:absolute;top:50%;margin-top:-40px;width:100%;">
					<h4 style="text-align:center;color:#fff;">
						点击班级条形图可为该班级投票
					</h4>
				</div>
			</div>

			<div class="page page4">
				<!-- 投票后的文字说明 -->
				<div class="tip">
					<h4>你为xxx班级贡献了一票</h4>
					<h4>该班级当前排名为xxx</h4>
					<h4>赶紧分享出去为班级拉票！</h4>
				</div>
				<!-- 引导分享 -->
				<div class="share">
					<input type="button" class="weixin" value="微信分享" onclick="showShareTo();">
					<input type="button" class="pengyouquan" value="朋友圈分享" onclick="showShareTo();">
				</div>
				<!-- 页脚 -->
				<div class="footer">
					<h3>Thanks:</h3>
					<ul class="coder">
						<li><span>宿疯</span></li>
						<li><span>钟涛</span></li>
						<li><span>黄韬</span></li>
						<li><span>嘉乐</span></li>
						<li><span>钟涛</span></li>
						<li><span>晓佳</span></li>
						<li><span>日强</span></li>
						<li><span>韵兴</span></li>
					</ul>
					<div class="copyright">
						<a href="http://xingkong.us">www.xingkong.us</a>
						<br>
						<span>星空学生创新中心&copy;2016</span>
					</div>
				</div>
				<!-- 分享遮罩层 -->
				<div class="shareTo" style="display:none;">
					
				</div>
			</div>
		</div>
	</div>
	<span class="start"><b></b></span>
	
	<script src="js/zepto.min.js"></script>
	<script src="src/zepto.fullpage.js"></script>
	<script src="http://static.geetest.com/static/tools/gt.js"></script>

<!-- 
<script src="__PUBLIC__/js/zepto.min.js"></script>
<script src="__PUBLIC__/JS/zepto.fullpage.js"></script>
<script src="http://static.geetest.com/static/tools/gt.js"></script>
-->
<script>
	var flag = false;
	var classId = null;
	var Bar = $('#Bar');
	var hint = $('.hint');

	$('.wp-inner').fullpage({
		change: function (e) {
                // 移除动画属性
                $('.page').eq(e.cur).find('.js-animate').each(function() {
                	$(this).removeClass($(this).data('animate')).hide();
                });
                // 初始化条形图动画
                $('.page').eq(e.cur).find('.skillbar').each(function(){
                	$(this).find('.skillbar-bar').animate({
                		width:$(this).attr('0%')
                	},100);
                });
            },
            afterChange: function (e) {
                // 添加动画属性
                $('.page').eq(e.cur).find('.js-animate')
                .each(function () {
                	$(this).addClass($(this).data('animate')).show();
                });
                // 添加条形图动画
                $('.page').eq(e.cur).find('.skillbar').each(function(){
                	$(this).find('.skillbar-bar').animate({
                		width:$(this).attr('data-percent')
                	},1200);
                });

                //每次翻页都获取最新的票数并刷新动画
                getclass();
                    // 添加条形图动画
                    $('.page').eq(e.cur).find('.skillbar').each(function () {
                    	$(this).find('.skillbar-bar').animate({
                    		width: $(this).attr('data-percent')
                    	}, 1200);
                    });


                // 判断是否为第三页，显示提示内容。
                if ($.fn.fullpage.getCurIndex() === 2) {
                	if(classId === -1){
                		setTimeout( function () {
                			hint.animate({opacity:1},500);
                		}
                		,1600);
                	}
                	hadeHint ();
                };

            }
        });
        // 点击隐藏提示
        function hadeHint () {
        	Bar.on('click', function (e) {
        		e.preventDefault();
        		hint.css('display', 'none');
        	});
        	hint.on('click', function (e) {
        		e.preventDefault();
        		$('.hint').css('display', 'none');
        	});
        }
        // 为条形图绑定点击事件
        function barOnClick(){
        	Bar.find('.skillbar').on('click', function (e) {
        		e.preventDefault();
        		classId = $(this).index();
        		$(this).children('.skillbar-bar').removeClass('disable');
        		$(this).siblings('.skillbar').children('.skillbar-bar').addClass('disable');
        	// 判断是否隐藏验证码
        	if (flag) {
        		$("#mask, #popup-captcha-mobile").hide();
        	}
        });
        	flag = true;
        	alert(classId)
        }
    </script>

    <script>
    	// 确定按钮
    	$(".btn").click(function () {
    		$("#popup-captcha-mobile").hide();
    	});
    	$("#popup-submit-mobile").click(function () {
    		if(flag){
    			$("#popup-captcha-mobile").show();
    		}
    	});

    	var handlerPopupMobile = function (captchaObj) {
        // 将验证码加到id为captcha的元素里
        captchaObj.appendTo("#popup-captcha-mobile");
        //拖动验证成功后两秒(可自行设置时间)自动发生跳转等行为
        captchaObj.onSuccess(function () {
        	var validate = captchaObj.getValidate();
        	$.ajax({
                url: "{:U('Home/Common/checkGeet')}", // 进行二次验证
                type: "post",
                dataType: "json",
                data: {
                    // 二次验证所需的三个值
                    type: "mobile",
                    // username: $('#username3').val(),
                    // password: $('#password3').val(),
                    geetest_challenge: validate.geetest_challenge,
                    geetest_validate: validate.geetest_validate,
                    geetest_seccode: validate.geetest_seccode
                },
                success: function (data) {
                	if (data && (data.status === "success")) {
                		$.fn.fullpage.moveNext(true);
                	} else {
                		$(document.body).html('<h1>登录失败</h1>');
                	}
                }
            });
        });
        // 更多接口参考：http://www.geetest.com/install/sections/idx-client-sdk.html
    };
    $.ajax({
        // 获取id，challenge，success（是否启用failback）
        url: "{:U('Home/Common/setGeet')}" + "?type=mobile&t=" + (new Date()).getTime(),  // 加随机数防止缓存
        type: "get",
        dataType: "json",
        success: function (data) {
            // 使用initGeetest接口
            // 参数1：配置参数
            // 参数2：回调，回调的第一个参数验证码对象，之后可以使用它做appendTo之类的事件
            initGeetest({
            	gt: data.gt,
            	challenge: data.challenge,
                offline: !data.success // 表示用户后台检测极验服务器是否宕机，一般不需要关注
                // 更多配置参数请参见：http://www.geetest.com/install/sections/idx-client-sdk.html#config
            }, handlerPopupMobile);
        }
    });
</script>
<script>
	// 引导微信分享
	function showShareTo(){
		$('.shareTo').show();
	}
	$('.shareTo').on('click', function(event) {
		event.preventDefault();
		$(this).hide();
	});
</script>

<script>
	    //获取班级方法
	    var getclass = function (classId) {
	    	$.ajax({
	    		url: "{:U('Home/Index/getClass')}",
	    		type: "post",
	    		dataType: "json",
	    		success: function (data,classId) {
                // console.log(data);
                var str = '';
                //计算票数百分比
                var sum = 0;
                console.log(data.data.length);
                for (var i = 0; i < data.data.length; i++) {
                	sum += parseInt(data.data[i].num);
                }
                Bar.children('.skillbar').each(function(index, el) {
                	$(this).data('percent', (data.data[index].num*72.3/sum)+27.4 + "%");
                	$(this).children('.skill-bar-percent').text(data.data[index].num + "票");
                });
            }
        })
	    };


	</script>





	<script>
	// 测试
	var classId = 2;
	var plus = false;
	if(classId != -1){
		var test = $('.skillbar').eq(classId);
		test.children('.skillbar-bar').removeClass('disable');
		test.siblings('.skillbar').children('.skillbar-bar').addClass('disable');
		$(".btn").attr({
			value: '已选'
		});
	}else {
		barOnClick();
		if(plus){

		}else{
			$(".tip").children()
		}
	}

	// 动态修改数据
	Bar.children('.skillbar').each(function(index, el) {
		$(this).data('percent', 5*index + "%");
		$(this).children('.skill-bar-percent').text(50*index + "票");
	});
</script>

</body>
</html>